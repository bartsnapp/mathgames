pico-8 cartridge // http://www.pico-8.com
version 16
__lua__
-- pattern power
-- by bart snapp

-- complete patterns

cartdata("pattern_power_1")

function _init()
   pause=0
   state="two_d_pattern"
   spr1=flr(rnd(3))*2
   spr2=flr(rnd(3))*2
   spr3=flr(rnd(3))*2
   missing=flr(rnd(8)) -- missing location
   mspr=32 -- missing sprite
end

-- a and b btn
abin={{0,1,1,1,1,1,0},
 	{1,1,1,0,1,1,1},
 	{1,1,0,0,0,1,1},
 	{1,1,0,1,0,1,1},
 	{0,1,1,1,1,1,0}}

bbin={{0,1,1,1,1,1,0},
 	{1,1,0,0,1,1,1},
 	{1,1,0,1,0,1,1},
 	{1,1,0,0,0,1,1},
 	{0,1,1,1,1,1,0}}
 	
function abtn(x,y,c)
   for i=1,5 do
      for j=1,7 do
	 if abin[i][j] == 0 then else
	    pset(j+x-1,i+y-1,c*abin[i][j])
	 end
      end
   end	
end

function bbtn(x,y,c)
   for i=1,5 do
      for j=1,7 do
	 if bbin[i][j] == 0 then else
	    pset(j+x-1,i+y-1,c*bbin[i][j])
	 end
      end	
   end
end
-->8
-- main update and draw

function _update()
   if state=="two_d_pattern"
   then update_two_d_pattern()
   elseif state=="success"
   then update_success()
   elseif state=="fail"
   then update_fail()
   end
end

function _draw()
   if state=="two_d_pattern"
   then draw_two_d_pattern()
   elseif state=="success"
   then draw_success()
   elseif state=="fail"
   then draw_fail()
   end
end
-->8
-- update



function validate(m,s) -- m=missing, and s=mspr, s is chosen sprite
   if s == 32 then -- has anything been selected? 32 is address of ?
   elseif (((m*16)%48==0 and spr1==s) or
	 ((m*16)%48==16 and spr2==s) or
	 ((m*16)%48==32 and spr3==s))
   then state="success" sfx(1) 
   else state="fail" sfx(2)
   end
end

function update_two_d_pattern()
	if btnp(0) or
		btnp(1) or
		btnp(2) or
		btnp(3)
	then -- cycles through sprites
		sfx(0)
		mspr=(mspr+2)%6 -- cycle through number of sprites
	end
	if btnp(4) or btnp(5) then 
	   validate(missing,mspr)
	end
end

function prep_next_two_d_pattern()
   pause+=1
   if pause == 20 then
      pause = 0
      state="two_d_pattern"
      spr1=flr(rnd(3))*2
      spr2=flr(rnd(3))*2
      spr3=flr(rnd(3))*2
      missing=flr(rnd(8)) -- missing location
      mspr=32 -- missing sprite
   end
end

function update_success()
   prep_next_two_d_pattern()
end

function update_fail()
   prep_next_two_d_pattern()
end
-->8
-- draw



function two_d_pattern(s1,s2,s3,m,s)
   for i=0,2 do
      spr(s1,0+48*i,56,2,2)
      spr(s2,16+48*i,56,2,2)
      spr(s3,32+48*i,56,2,2)
   end
   rectfill(128,56,144,71,0) -- removes hidden sprite
   rectfill(16*m,
	    56,
	    16*m+15,
	    71,0)
   if s == 32 then -- initial question mark
      pal(7,ceil(t/2)%16)
      pal(6,(ceil(t/2)-1)%16)
      pal(5,(ceil(t/2)-2)%16)
      spr(s,16*m,56,2,2)
      pal(7,7)
   else spr(s,16*m,56,2,2)
   end
end

t=1
function draw_two_d_pattern()
   cls()
   t+=1
   camera(0,0)
   two_d_pattern(spr1,spr2,spr3,missing,mspr)
   print("⬆️⬇️⬅️➡️ cycles patterns", 10,110,7)
   abtn(10,120,7)
   bbtn(18,120,7)
   print("checks your answer", 30,120,7)
   t%=50
end


function draw_success()
   cls()
   print("nice work!",10,63,7)
end

function draw_fail()
   camera(3-rnd(3),0)
   cls()
   two_d_pattern(spr1,spr2,spr3,missing,mspr)
end

__gfx__
77777777777777770000000990000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
78888888888888870000004aa4000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
78999999999999870000009aa90000000000eeeeeeee000000000000000000000000000000000000000000000000000000000000000000000000000000000000
789bbbbbbbbbb9870000009aa9000000000ee888888ee00000000000000000000000000000000000000000000000000000000000000000000000000000000000
789b11111111b987000009aaaa90000000ee88888888ee0000000000000000000000000000000000000000000000000000000000000000000000000000000000
789b1cccccc1b98749999aaaaaa999940ee8899999988ee000000000000000000000000000000000000000000000000000000000000000000000000000000000
789b1caaaac1b98704aaaaaaaaaaaa40ee8899aaaa9988ee00000000000000000000000000000000000000000000000000000000000000000000000000000000
789b1ca33ac1b9870049aaaaaaaa9400e8899aabbaa9988e00000000000000000000000000000000000000000000000000000000000000000000000000000000
789b1ca33ac1b98700049aaaaaa940008899aabbbbaa998800000000000000000000000000000000000000000000000000000000000000000000000000000000
789b1caaaac1b98700004aaaaaa40000899aabbccbbaa99800000000000000000000000000000000000000000000000000000000000000000000000000000000
789b1cccccc1b98700049aaaaaa9400099aabbccccbbaa9900000000000000000000000000000000000000000000000000000000000000000000000000000000
789b11111111b98700049aaaaaa94000aaabbcc11ccbbaaa00000000000000000000000000000000000000000000000000000000000000000000000000000000
789bbbbbbbbbb9870049aaa99aaa9400bbbbcc1111ccbbbb00000000000000000000000000000000000000000000000000000000000000000000000000000000
78999999999999870049aa9009aa9400ccccc112211ccccc00000000000000000000000000000000000000000000000000000000000000000000000000000000
7888888888888887049a94000049a940111111222211111100000000000000000000000000000000000000000000000000000000000000000000000000000000
77777777777777774994000000004994222222222222222200000000000000000000000000000000000000000000000000000000000000000000000000000000
00005666660000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00057777776000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00067655557600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00067600057600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00056500007600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000007600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000007600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000077500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000057765000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000067600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000067600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000056500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000056500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000067600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000056500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__sfx__
000100002085026850268502585024850218501e8001c8003580011800128001280013800348002180020800208001f8001e8001e8001d8001d8001c8001c80022e001c8001b80020e001b800000000000000000
0003000012050120501205015e5012050130501405015050180501b0501d0502bf500b0500e05020f50140501a0501d0502405033f5015050170501b0501e05024050270502f0503605039050000000000000000
00030000016503f650016503f650016503f650016503f650016503f650016503f6500660009600376001560017600336000200002000020000100000000000000000000000000000000000000000000000000000
